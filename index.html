<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RLC Cheat-Sheet Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA / iPhone app-like setup -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#000000" />

  <!-- iOS specific -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="RLC Cheat Calc" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 1rem;
      line-height: 1.4;
      background: #050505;
      color: #f5f5f5;
    }
    h1 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .field {
      flex: 1 1 140px;
      min-width: 140px;
    }
    label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 0.15rem;
    }
    input, select, button {
      width: 100%;
      padding: 0.35rem 0.45rem;
      font-size: 0.9rem;
      box-sizing: border-box;
      border-radius: 4px;
      border: 1px solid #333;
      background: #111;
      color: #f5f5f5;
    }
    button {
      cursor: pointer;
      margin-top: 0.4rem;
      border: 1px solid #444;
    }
    button:active {
      transform: scale(0.98);
    }
    .results {
      margin-top: 1rem;
      padding: 0.75rem;
      border: 1px solid #333;
      border-radius: 4px;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.8rem;
      white-space: pre-wrap;
      background: #0d0d0d;
    }
  </style>
</head>
<body>
  <h1>RLC Cheat-Sheet Calculator</h1>

  <div class="row">
    <div class="field">
      <label for="ctype">Circuit</label>
      <select id="ctype">
        <option value="series_RL">Series RL</option>
        <option value="series_RC">Series RC</option>
        <option value="series_RLC">Series RLC</option>
        <option value="parallel_RL">Parallel RL</option>
        <option value="parallel_RC">Parallel RC</option>
        <option value="parallel_RLC">Parallel RLC</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div class="field">
      <label for="V">Source voltage V (rms, volts)</label>
      <input id="V" type="number" step="any" inputmode="decimal" placeholder="e.g. 120" />
    </div>
    <div class="field">
      <label for="f">Frequency f (Hz)</label>
      <input id="f" type="number" step="any" inputmode="decimal" placeholder="e.g. 60" />
    </div>
  </div>

  <div class="row">
    <div class="field">
      <label for="R">Resistance R (Ω)</label>
      <input id="R" type="number" step="any" inputmode="decimal" placeholder="e.g. 50" />
    </div>
    <div class="field">
      <label for="L">Inductance L (H)</label>
      <input id="L" type="number" step="any" inputmode="decimal" placeholder="e.g. 0.2" />
    </div>
    <div class="field">
      <label for="C">Capacitance C (µF)</label>
      <input id="C" type="number" step="any" inputmode="decimal" placeholder="e.g. 5" />
    </div>
  </div>

  <button onclick="calculate()">Calculate</button>

  <div class="results" id="results"></div>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("sw.js").catch(() => {});
      });
    }

    function val(id) {
      const x = parseFloat(document.getElementById(id).value);
      return isNaN(x) ? 0 : x;
    }

    function fmt(x, digits = 3) {
      if (!isFinite(x)) return "—";
      return x.toFixed(digits);
    }

    function calculate() {
      const ctype = document.getElementById("ctype").value;

      const V = val("V");
      const f = val("f");
      const R = val("R");
      const L = val("L");
      const C_uF = val("C");
      const C = C_uF * 1e-6;

      const TWO_PI = 2 * Math.PI;
      const XL = (L > 0 && f > 0) ? TWO_PI * f * L : 0;
      const XC = (C > 0 && f > 0) ? 1 / (TWO_PI * f * C) : Infinity;

      let out = "";

      out += "GIVEN\n";
      out += "-----\n";
      out += `Circuit type:  ${ctype.replace("_", " ").toUpperCase()}\n`;
      out += `V (rms):       ${fmt(V)} V\n`;
      out += `f:             ${fmt(f)} Hz\n`;
      out += `R:             ${fmt(R)} Ω\n`;
      out += `L:             ${fmt(L)} H\n`;
      out += `C:             ${fmt(C_uF)} µF\n\n`;

      out += "REACTANCES\n";
      out += "----------\n";
      out += `X_L = 2πfL       = ${fmt(XL)} Ω\n`;
      out += `X_C = 1/(2πfC)   = ${XC === Infinity ? "∞ (no C or f=0)" : fmt(XC) + " Ω"}\n\n`;

      let IT = 0;
      let theta = 0;

      if (ctype.startsWith("series")) {
        let Xnet = 0;
        if (ctype === "series_RL")   Xnet = XL;
        if (ctype === "series_RC")   Xnet = -(XC === Infinity ? 0 : XC);
        if (ctype === "series_RLC")  Xnet = XL - (XC === Infinity ? 0 : XC);

        const Zmag = Math.sqrt(R*R + Xnet*Xnet);
        theta = Math.atan2(Xnet, R);
        const thetaDeg = theta * 180 / Math.PI;
        const I = Zmag > 0 ? V / Zmag : 0;
        IT = I;

        const VR = I * R;
        const VL = I * XL;
        const VC = (XC === Infinity) ? 0 : I * XC;

        const pf = Math.cos(theta);
        const angleType = thetaDeg > 0.0001 ? "lagging (inductive)" :
                          thetaDeg < -0.0001 ? "leading (capacitive)" :
                          "unity";

        out += "SERIES RESULTS\n";
        out += "--------------\n";
        out += `X_net = X_L − X_C   = ${fmt(Xnet)} Ω\n`;
        out += `Z_T = √(R² + X_net²) = ${fmt(Zmag)} Ω\n`;
        out += `I_T = V / Z_T       = ${fmt(I)} A\n\n`;

        out += "COMPONENT VOLTAGES\n";
        out += "------------------\n";
        out += `V_R = I_T·R   = ${fmt(VR)} V\n`;
        out += `V_L = I_T·X_L = ${fmt(VL)} V\n`;
        out += `V_C = I_T·X_C = ${XC === Infinity ? "— (no C)" : fmt(VC) + " V"}\n\n`;

        out += "ANGLE & POWER FACTOR\n";
        out += "--------------------\n";
        out += `θ = atan(X_net / R) = ${fmt(thetaDeg)}°\n`;
        out += `PF = cos(θ)         = ${fmt(pf)} (${angleType})\n\n`;

      } else {
        const IR = (R > 0) ? V / R : 0;
        const IL = (XL > 0 && XL !== Infinity) ? V / XL : 0;
        const IC = (XC !== Infinity && XC > 0) ? V / XC : 0;

        const useL = (ctype === "parallel_RL" || ctype === "parallel_RLC");
        const useC = (ctype === "parallel_RC" || ctype === "parallel_RLC");

        const IL_used = useL ? IL : 0;
        const IC_used = useC ? IC : 0;

        const IQ = IL_used - IC_used;
        const ITmag = Math.sqrt(IR*IR + IQ*IQ);
        IT = ITmag;
        theta = Math.atan2(IQ, IR);
        const thetaDeg = theta * 180 / Math.PI;
        const pf = Math.cos(theta);
        const angleType = thetaDeg > 0.0001 ? "lagging (inductive)" :
                          thetaDeg < -0.0001 ? "leading (capacitive)" :
                          "unity";

        out += "PARALLEL RESULTS\n";
        out += "----------------\n";
        out += `I_R = V / R     = ${fmt(IR)} A\n`;
        if (useL) out += `I_L = V / X_L   = ${fmt(IL_used)} A (lagging)\n`;
        if (useC) out += `I_C = V / X_C   = ${XC === Infinity ? "— (no C)" : fmt(IC_used) + " A (leading)"}\n`;
        out += `I_Q = I_L − I_C = ${fmt(IQ)} A\n`;
        out += `I_T = √(I_R² + I_Q²) = ${fmt(ITmag)} A\n`;
        out += `θ = atan(I_Q / I_R)  = ${fmt(thetaDeg)}°\n`;
        out += `PF = cos(θ)          = ${fmt(pf)} (${angleType})\n\n`;
      }

      const pf_global = Math.cos(theta);
      const S = V * IT;
      const P = S * pf_global;
      const Q = S * Math.sin(theta);

      out += "POWER\n";
      out += "-----\n";
      out += `S = V·I_T       = ${fmt(S)} VA\n`;
      out += `P = V·I_T·cosθ  = ${fmt(P)} W\n`;
      out += `Q = V·I_T·sinθ  = ${fmt(Q)} VAR\n`;

      out += "\nCOPY TO CHEAT SHEET BOXES:\n";
      out += "X_L, X_C, X_net, Z_T, I_T, V_R, V_L, V_C, θ, PF, P, Q, S.\n";

      document.getElementById("results").textContent = out;
    }
  </script>
</body>
</html>
