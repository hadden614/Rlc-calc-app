<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AC Series / Parallel RL RC RLC Master Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }
    .card {
      max-width: 960px;
      margin: 0 auto;
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    h1 {
      font-size: 20px;
      margin-top: 0;
      text-align: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    label {
      font-size: 13px;
      font-weight: 600;
    }
    input, select {
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      margin-top: 16px;
      width: 100%;
      padding: 10px;
      border-radius: 4px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: #222;
      color: #fff;
    }
    button:active {
      transform: scale(0.98);
    }
    .results {
      margin-top: 20px;
      border-top: 1px solid #ddd;
      padding-top: 12px;
      font-size: 14px;
    }
    .results h2 {
      font-size: 16px;
      margin: 4px 0 8px;
    }
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 8px;
    }
    .result-item {
      background: #fafafa;
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #eee;
    }
    .result-label {
      font-weight: 600;
      font-size: 13px;
    }
    .note {
      font-size: 11px;
      color: #666;
      margin-top: 6px;
    }
    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>AC Series / Parallel RL RC RLC Master Calculator</h1>

    <div class="row">
      <div class="field">
        <label for="connectionType">Connection type</label>
        <select id="connectionType">
          <option value="series" selected>Series</option>
          <option value="parallel">Parallel</option>
        </select>
      </div>
      <div class="field">
        <label for="circuitConfig">Circuit</label>
        <select id="circuitConfig">
          <option value="rl">RL</option>
          <option value="rc">RC</option>
          <option value="rlc" selected>RLC</option>
        </select>
      </div>
    </div>
    <div class="note">
      RL = R + L, RC = R + C, RLC = R + L + C. Switch Series / Parallel on the left.
    </div>

    <div class="grid" style="margin-top:12px;">
      <div class="field">
        <label for="voltage">Source voltage (V<sub>RMS</sub>)</label>
        <input id="voltage" type="number" step="any" placeholder="e.g. 120" />
      </div>
      <div class="field">
        <label for="frequency">Frequency (Hz)</label>
        <input id="frequency" type="number" step="any" placeholder="e.g. 60" />
      </div>
      <div class="field">
        <label for="resistance">Resistance R (Ω)</label>
        <input id="resistance" type="number" step="any" placeholder="e.g. 50" />
      </div>
    </div>

    <div id="inductanceGroup" style="margin-top:12px;">
      <h2 style="font-size:14px;margin:0 0 4px;">Inductance / Inductive Reactance</h2>
      <div class="grid">
        <div class="field">
          <label for="inductance">Inductance L (mH)</label>
          <input id="inductance" type="number" step="any" placeholder="leave blank if using X<sub>L</sub>" />
        </div>
        <div class="field">
          <label for="xL">Inductive reactance X<sub>L</sub> (Ω)</label>
          <input id="xL" type="number" step="any" placeholder="overrides L if filled" />
        </div>
      </div>
      <div class="note">
        If X<sub>L</sub> is entered, it is used directly. Otherwise X<sub>L</sub> = 2πfL.
      </div>
    </div>

    <div id="capacitanceGroup" style="margin-top:12px;">
      <h2 style="font-size:14px;margin:12px 0 4px;">Capacitance / Capacitive Reactance</h2>
      <div class="grid">
        <div class="field">
          <label for="capacitance">Capacitance C (µF)</label>
          <input id="capacitance" type="number" step="any" placeholder="leave blank if using X<sub>C</sub>" />
        </div>
        <div class="field">
          <label for="xC">Capacitive reactance X<sub>C</sub> (Ω)</label>
          <input id="xC" type="number" step="any" placeholder="overrides C if filled" />
        </div>
      </div>
      <div class="note">
        If X<sub>C</sub> is entered, it is used directly. Otherwise X<sub>C</sub> = 1 / (2πfC).
      </div>
    </div>

    <button id="calcBtn">Calculate</button>

    <div class="results" id="results" style="display:none;">
      <h2>Results</h2>
      <div class="results-grid">
        <div class="result-item"><span class="result-label">X<sub>L</sub>:</span> <span id="resXL"></span></div>
        <div class="result-item"><span class="result-label">X<sub>C</sub>:</span> <span id="resXC"></span></div>
        <div class="result-item"><span class="result-label">Net reactance X (series):</span> <span id="resXnet"></span></div>
        <div class="result-item"><span class="result-label">|Z| (Ω):</span> <span id="resZ"></span></div>

        <div class="result-item"><span class="result-label">I<sub>R</sub>:</span> <span id="resIR"></span></div>
        <div class="result-item"><span class="result-label">I<sub>L</sub>:</span> <span id="resIL"></span></div>
        <div class="result-item"><span class="result-label">I<sub>C</sub>:</span> <span id="resIC"></span></div>
        <div class="result-item"><span class="result-label">I<sub>T</sub>:</span> <span id="resIT"></span></div>

        <div class="result-item"><span class="result-label">P<sub>true</sub> (W):</span> <span id="resPtrue"></span></div>
        <div class="result-item"><span class="result-label">Q<sub>L</sub> (VAR):</span> <span id="resQ_L"></span></div>
        <div class="result-item"><span class="result-label">Q<sub>C</sub> (VAR):</span> <span id="resQ_C"></span></div>

        <div class="result-item"><span class="result-label">S<sub>load</sub> (VA):</span> <span id="resSload"></span></div>
        <div class="result-item"><span class="result-label">S<sub>source</sub> (VA):</span> <span id="resSsource"></span></div>

        <div class="result-item"><span class="result-label">Power factor:</span> <span id="resPF"></span></div>
        <div class="result-item"><span class="result-label">θ (degrees):</span> <span id="resTheta"></span></div>
      </div>
      <div class="note" id="pfNote"></div>
    </div>
  </div>

  <script>
    const connectionTypeEl = document.getElementById("connectionType");
    const circuitConfigEl = document.getElementById("circuitConfig");
    const inductanceGroup = document.getElementById("inductanceGroup");
    const capacitanceGroup = document.getElementById("capacitanceGroup");

    function clearInductanceInputs() {
      document.getElementById("inductance").value = "";
      document.getElementById("xL").value = "";
    }

    function clearCapacitanceInputs() {
      document.getElementById("capacitance").value = "";
      document.getElementById("xC").value = "";
    }

    function updateVisibility() {
      const config = circuitConfigEl.value;
      if (config === "rl") {
        inductanceGroup.style.display = "block";
        capacitanceGroup.style.display = "none";
        clearCapacitanceInputs();
      } else if (config === "rc") {
        inductanceGroup.style.display = "none";
        capacitanceGroup.style.display = "block";
        clearInductanceInputs();
      } else {
        // rlc
        inductanceGroup.style.display = "block";
        capacitanceGroup.style.display = "block";
      }
    }

    circuitConfigEl.addEventListener("change", updateVisibility);
    connectionTypeEl.addEventListener("change", () => {
      // Visibility of L/C is only based on RL/RC/RLC, so just refresh.
      updateVisibility();
    });
    updateVisibility();

    function num(val) {
      const v = parseFloat(val);
      return isNaN(v) ? 0 : v;
    }

    function fmt(val, digits = 3) {
      if (!isFinite(val)) return "N/A";
      return Number(val).toFixed(digits);
    }

    document.getElementById("calcBtn").addEventListener("click", () => {
      const V = num(document.getElementById("voltage").value);
      const f = num(document.getElementById("frequency").value);
      const R = num(document.getElementById("resistance").value);
      const connection = connectionTypeEl.value; // "series" or "parallel"
      const config = circuitConfigEl.value;      // "rl", "rc", "rlc"

      if (V === 0 || R === 0) {
        alert("Enter at least non-zero source voltage and resistance.");
        return;
      }
      if (f === 0) {
        alert("Frequency must be non-zero.");
        return;
      }

      // Read L, C, XL, XC
      let XL_input = document.getElementById("xL").value.trim();
      let XC_input = document.getElementById("xC").value.trim();
      let L_input  = document.getElementById("inductance").value.trim();
      let C_input  = document.getElementById("capacitance").value.trim();

      let XL = 0;
      let XC = 0;

      // Inductive reactance
      if (config === "rc") {
        XL = 0;
      } else {
        if (XL_input !== "") {
          XL = num(XL_input);
        } else if (L_input !== "") {
          const L_H = num(L_input) * 1e-3;
          XL = 2 * Math.PI * f * L_H;
        } else {
          XL = 0;
        }
      }

      // Capacitive reactance
      if (config === "rl") {
        XC = 0;
      } else {
        if (XC_input !== "") {
          XC = num(XC_input);
        } else if (C_input !== "") {
          const C_F = num(C_input) * 1e-6;
          if (C_F !== 0) {
            XC = 1 / (2 * Math.PI * f * C_F);
          } else {
            XC = 0;
          }
        } else {
          XC = 0;
        }
      }

      let IR = 0, IL = 0, IC = 0, IT = 0;
      let Ptrue = 0, Q_L = 0, Q_C = 0, S = 0;
      let pf = 0, thetaDeg = 0, Zmag = 0;
      let Xnet = 0;

      if (connection === "series") {
        // SERIES: Z = R + j(XL - XC)
        Xnet = XL - XC;
        const Z = Math.sqrt(R * R + Xnet * Xnet);
        if (Z === 0) {
          alert("Impedance ended up zero. Check your inputs.");
          return;
        }
        Zmag = Z;
        IT = V / Z;
        IR = IT;
        IL = (config === "rc") ? 0 : IT;
        IC = (config === "rl") ? 0 : IT;

        Ptrue = IT * IT * R;
        Q_L = (config === "rc" || XL === 0) ? 0 : IT * IT * XL;
        Q_C = (config === "rl" || XC === 0) ? 0 : IT * IT * XC;
        S = V * IT;

        const cosTheta = R / Z;
        pf = cosTheta;
        const thetaRad = Math.atan2(Xnet, R);
        thetaDeg = thetaRad * 180 / Math.PI;
      } else {
        // PARALLEL: currents split; use current triangle
        IR = V / R;
        IL = (config === "rc" || XL === 0) ? 0 : V / XL;
        IC = (config === "rl" || XC === 0) ? 0 : V / XC;

        const Ireactive = IL - IC; // + = inductive, - = capacitive
        IT = Math.sqrt(IR * IR + Ireactive * Ireactive);
        if (IT === 0) {
          alert("Total current ended up zero. Check your inputs.");
          return;
        }
        Zmag = V / IT;

        Ptrue = V * IR;
        Q_L = V * IL;
        Q_C = V * IC;
        S = V * IT;

        const pfMag = IR / IT;
        let thetaAbs = Math.atan2(Math.abs(Ireactive), IR) * 180 / Math.PI;
        if (Ireactive < 0) {
          thetaDeg = -thetaAbs;
        } else {
          thetaDeg = thetaAbs;
        }
        // signed PF: positive for inductive (lagging), negative for capacitive (leading)
        pf = pfMag * (Ireactive >= 0 ? 1 : -1);
        // For Net reactance X (series-only), we'll set "N/A" below.
        Xnet = NaN;
      }

      // Update UI
      document.getElementById("resXL").textContent = fmt(XL) + " Ω";
      document.getElementById("resXC").textContent = fmt(XC) + " Ω";
      if (connection === "series") {
        document.getElementById("resXnet").textContent = fmt(Xnet) + " Ω";
      } else {
        document.getElementById("resXnet").textContent = "N/A (parallel)";
      }
      document.getElementById("resZ").textContent = fmt(Zmag) + " Ω";

      document.getElementById("resIR").textContent = fmt(IR) + " A";
      document.getElementById("resIL").textContent =
        (config === "rc" || XL === 0) ? "N/A (no L)" : fmt(IL) + " A";
      document.getElementById("resIC").textContent =
        (config === "rl" || XC === 0) ? "N/A (no C)" : fmt(IC) + " A";
      document.getElementById("resIT").textContent = fmt(IT) + " A";

      document.getElementById("resPtrue").textContent = fmt(Ptrue) + " W";
      document.getElementById("resQ_L").textContent =
        (config === "rc" || XL === 0) ? "N/A" : fmt(Q_L) + " VAR";
      document.getElementById("resQ_C").textContent =
        (config === "rl" || XC === 0) ? "N/A" : fmt(Q_C) + " VAR";

      document.getElementById("resSload").textContent = fmt(S) + " VA";
      document.getElementById("resSsource").textContent = fmt(S) + " VA";

      document.getElementById("resPF").textContent = fmt(pf, 4);
      document.getElementById("resTheta").textContent = fmt(thetaDeg, 2) + "°";

      const pfNote = document.getElementById("pfNote");
      if (connection === "series") {
        if (Xnet > 0) {
          pfNote.textContent = "Series circuit: inductive (lagging) power factor, θ positive.";
        } else if (Xnet < 0) {
          pfNote.textContent = "Series circuit: capacitive (leading) power factor, θ negative.";
        } else {
          pfNote.textContent = "Series circuit: unity power factor, θ ≈ 0°.";
        }
      } else {
        // parallel
        if (pf > 0) {
          pfNote.textContent = "Parallel circuit: inductive (lagging) if θ > 0, capacitive (leading) if θ < 0.";
        } else {
          pfNote.textContent = "Parallel circuit: negative PF indicates leading (capacitive) behavior.";
        }
      }

      document.getElementById("results").style.display = "block";
    });
  </script>
</body>
</html>